var app=app||{};app.init=function(){app.model=new app.Hotel,app.vm=new app.ViewModel,app.hv=new app.HotelView,app.mv=new app.MapView,app.model.init(),app.hv.init(),ko.applyBindings(app.vm)},app.errorHandler=function(e){var n=document.getElementById("map");n.innerHTML="There was an error loading the "+e+" script."},app.Hotel=function(){"use strict";var e=this;e.hotels=ko.observableArray(),e.yelp={},e.init=function(){var n,t,o=0,a=[],i=0;e.reqTimeout(),n=new Firebase("https://crackling-heat-3113.firebaseio.com"),n.once("value",function(n){for(e.yelp=n.child("yelp").val(),t=n.child("hotels").val(),i=t.length,o;i>o;o++)a=t[o],a.content=null,e.hotels.push(a);app.vm.init()},function(e){var n="Could not load hotel data. The read failed with error code: ";n+=e.code+". Please contact the webmaster.",document.getElementById("map").innerHTML=n})},e.reqTimeout=function(){var e=document.getElementById("map"),n="Map request timed out. Check your connection and refresh the page.";setTimeout(function(){"FIGCAPTION"===e.children[0].nodeName&&(e.innerHTML=n)},1e4)}},app.ViewModel=function(){"use strict";var e=this;e.hotelList=ko.observableArray(),e.filterList=ko.observableArray(),e.filterText=ko.observable(""),e.ratingsChecked=ko.observableArray(),e.ratings=ko.observableArray([{ratingValue:5,icon:"aaaaa",color:"red"},{ratingValue:4,icon:"aaaa",color:"yellow"},{ratingValue:3,icon:"aaa",color:"green"},{ratingValue:2,icon:"aa",color:"purple"}]),e.getRatings=function(){return e.ratings()},e.nameSort=function(e,n){return e.name==n.name?0:e.name<n.name?-1:1},e.getHotels=ko.computed(function(){var n=app.model.hotels();return n.sort(e.nameSort),n}),e.getHotelsLength=ko.computed(function(){return app.model.hotels().length}),e.getKeys=function(){return app.model.yelp},e.init=function(){e.hotelList(e.getHotels()),app.mv.initMap()},e.slideIn=function(){app.hv.slideInLeft(),google.maps.event.trigger(app.mv.map,"resize")},e.slideOut=function(){app.hv.slideOutLeft(),google.maps.event.trigger(app.mv.map,"resize"),app.mv.map.setCenter(app.mv.currentLocation),window.screen.height>400&&app.mv.map.panBy(0,-120)},e.noEnter=function(e,n){return!1},e.gotoHotel=function(e){app.mv.map.setCenter(e.location),window.screen.height>400&&app.mv.map.panBy(0,-120),app.mv.infoWindow.close(),google.maps.event.trigger(e.marker,"click")},e.filterRatings=function(n,t){return e.hotelDisplay(),!0},e.open=function(){app.hv.openInfo()},e.close=function(){app.hv.closeInfo()},e.hotelDisplay=ko.computed(function(){var n=-1,t=[],o=e.filterText().toLowerCase(),a=e.ratingsChecked().length,i=0,r=-1;return e.filterList(e.hotelList()),!o&&0>=a?(e.filterList().forEach(function(e,n){e.marker&&e.marker.setVisible(!0)}),e.filterList):(e.filterList().forEach(function(l,s){n=l.name.toLowerCase().indexOf(o),i=l.diamonds,r=a>0?e.ratingsChecked.indexOf(i):0,n>=0&&r>=0?(l.marker.setVisible(!0),t.push(l)):(l.marker.setVisible(!1),app.mv.infoWindow.close())}),e.filterList(t),e.filterList)})},app.HotelView=function(){"use strict";var e=this;e.slide=document.getElementById("slide"),e.animateIn="animated slideInLeft no-overlay",e.animateOut="animated fadeOutLeft overlay",e.h3=document.getElementsByTagName("h3"),e.def=document.getElementById("definitions"),e.slideInLeft=function(){e.slide.className=e.animateIn},e.slideOutLeft=function(){e.slide.className=e.animateOut},e.openInfo=function(){e.def.style.display="block"},e.closeInfo=function(){e.def.style.display=""},e.toggleDisplay=function(e,n){return"icons icon-down"!=n?(n="icons icon-down",e.nextElementSibling.style.display="block"):(n="icons icon-right",e.nextElementSibling.style.display="none"),n},e.setIcon=function(n){var t;t="H3"===n.target.nodeName?n.target:n.target.parentNode,t.firstChild.className=e.toggleDisplay(t,t.firstChild.className)},e.init=function(){var n=0,t=e.h3.length;for(n;t>n;n++)e.h3[n].addEventListener("click",e.setIcon,!1)}},app.MapView=function(){"use strict";var e=this;e.infoWindow=null,e.currentLocation=null,e.currentMapCenter=null,e.originalMapCenter={lat:36.1049534,lng:-115.1724043},e.mapDiv=document.getElementById("map"),e.mapOptions={disableDefaultUI:!0,center:e.originalMapCenter,zoom:15,zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP}},e.preload='<div class="preload">Loading...<div class="spin"></div></div>',e.markerUrl="http://maps.google.com/mapfiles/ms/icons/",e.markerColors=["pink","blue","purple","green","yellow","red"],e.initMap=function(){e.map=new google.maps.Map(e.mapDiv,e.mapOptions),e.infoWindow=new google.maps.InfoWindow,e.createMarkers(),google.maps.event.addDomListener(window,"resize",function(){google.maps.event.trigger(e.map,"resize")}),google.maps.event.addListener(e.map,"resize",function(){e.currentMapCenter=e.map.getCenter(),e.map.setCenter(e.currentMapCenter)})},e.createMarkers=function(){var n=0,t={},o=app.vm.getHotels(),a=app.vm.getHotelsLength();for(n;a>n;n++)t=o[n],t.color=e.markerColors[t.diamonds],t.marker=new google.maps.Marker({map:e.map,position:t.location,title:t.name,animation:null,visible:!0,icon:e.markerUrl+t.color+".png"}),e.setInfoWin(t)},e.animateMarker=function(n){n.marker.setAnimation(google.maps.Animation.BOUNCE),n.marker.icon=e.markerUrl+n.color+"-dot.png",setTimeout(function(){n.marker.setAnimation(null),n.marker.icon=e.markerUrl+n.color+".png"},2100)},e.setInfoWin=function(n){google.maps.event.addListener(n.marker,"click",function(){n.content?e.infoWindow.setContent(n.content):(e.infoWindow.setContent(e.preload),e.getContent(n)),e.infoWindow.open(e.map,n.marker),e.animateMarker(n),e.currentLocation=n.location})},e.getContent=function(n){function t(){return Math.floor(1e12*Math.random()).toString()}var o="http://api.yelp.com/v2/business/"+n.id,a=app.vm.getKeys(),i={oauth_consumer_key:a.CONSUMER_KEY,oauth_token:a.TOKEN,oauth_nonce:t(),oauth_timestamp:Math.floor(Date.now()/1e3),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb"},r=oauthSignature.generate("GET",o,i,a.CONSUMER_SECRET,a.TOKEN_SECRET);i.oauth_signature=r,$jsonp.send(o,{callbackName:"cb",data:i,onSuccess:function(t){n.content=e.getTemplate(n.name,n.diamonds,t.image_url,t.snippet_text,t.url),e.infoWindow.setContent(n.content)},onTimeout:function(){n.content=null,e.infoWindow.setContent("Error retrieving Yelp data.<br>Please try again.")},timeout:5})},e.getTemplate=function(e,n,t,o,a){var i=0,r=app.vm.getRatings(),l=r.length,s="",p="";for(i;l>i;i++)if(r[i].ratingValue===n){p=r[i].icon;break}return s="<h4>"+e+"</h4>",s+='<i class="diamonds small">'+p+"</i>",s+='<div class="gm-info-container">',s+='  <div class="gm-info-image"><img src="'+t+'"></div>',s+='  <div class="gm-info-text">',s+='<img src="images/yelp_reviews.png" alt="Yelp Reviews"><br>',s+=o+' <a href="'+a+'">read more</a>',s+="  </div>",s+="</div>"}};var $jsonp=function(){var e={};return e.send=function(e,n){var t=n||{},o=t.callbackName||"callback",a=t.onSuccess||function(){},i=t.onTimeout||function(){},r=t.timeout||10,l=t.data||{},s="?";for(var p in l)l.hasOwnProperty(p)&&(s+=encodeURIComponent(p)+"="+encodeURIComponent(l[p])+"&");var c=window.setTimeout(function(){window[o]=function(){},i()},1e3*r);window[o]=function(e){window.clearTimeout(c),a(e)};var m=document.createElement("script");m.type="text/javascript",m.async=!0,m.src=e+s,document.getElementsByTagName("head")[0].appendChild(m)},e}();